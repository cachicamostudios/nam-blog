---
import Layout from '../layouts/Layout.astro';
import BlogPostLayout from '../layouts/BlogPostLayout.astro';
import { getCollection, getEntryBySlug } from 'astro:content';

const { slug } = Astro.params;
const post = await getEntryBySlug('blog', slug);

if (!post) {
  throw new Error(`Post not found: ${slug}`);
}

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
  }));
}
---

<Layout title={post.data.title}>
  <BlogPostLayout
    title={post.data.title}
    title_en={post.data.title_en}
    subtitle={post.data.subtitle}
    subtitle_en={post.data.subtitle_en}
    pubDate={post.data.pubDate}
    author={post.data.author}
  >
    <article class="prose dark:prose-invert max-w-3xl mx-auto">
      <div class="lang-es">{post.body}</div>
      <div class="lang-en hidden">{post.data.body_en ?? post.body}</div>
    </article>
  </BlogPostLayout>
</Layout>
