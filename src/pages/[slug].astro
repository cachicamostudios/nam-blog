---
import Layout from '../layouts/Layout.astro';
import BlogPostLayout from '../layouts/BlogPostLayout.astro';
import { getEntryBySlug, getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

const { post } = Astro.props;

if (!post) {
  throw new Error(`Post not found: ${Astro.params.slug}`);
}
---

<Layout title={post.data.title}>
  <BlogPostLayout 
    title={post.data.title}
    title_en={post.data.title_en}
    subtitle={post.data.subtitle}
    subtitle_en={post.data.subtitle_en}
    pubDate={post.data.pubDate}
    author={post.data.author}
  >
    <article class="prose dark:prose-invert max-w-3xl mx-auto">
      <div class="lang-es">
        {post.body}
      </div>
      <div class="lang-en hidden">
        {post.data.body_en ?? post.body}
      </div>
    </article>
  </BlogPostLayout>

  <script>
    function setLanguage(lang) {
      document.querySelectorAll('[class*=lang-]').forEach(el => el.classList.add('hidden'));
      document.querySelectorAll(`.lang-${lang}`).forEach(el => el.classList.remove('hidden'));
      document.documentElement.setAttribute('lang', lang);
      localStorage.setItem('lang', lang);
    }

    const currentLang = localStorage.getItem('lang') || 'es';
    setLanguage(currentLang);
  </script>
</Layout>
